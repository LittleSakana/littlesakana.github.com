---
layout: article
title: "内存分区"
categories: other
excerpt: "正确的理解C/C++程序的内存分区，是合格程序猿的基本要求"
ads: true
share: false
image:
---

## 分区

先来看一张图：

![内存分区](http://ono52urzb.bkt.clouddn.com/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA.png)

### 数据区

堆，栈，静态存储区。

#### 静态存储区

常量区（静态常量区），全局区（全局变量区）和静态变量区（静态区）。

##### 常量区

字符串常量区和常变量区。 

### 代码区

存放程序编译后的二进制代码，不可寻址区。

## 详细描述

### 堆区

由程序猿手动申请，手动释放，若不手动释放，程序结束后由系统回收，生命周期是整个程序运行期间。使用malloc或者new进行堆的申请，堆的总大小为机器的虚拟内存的大小。

### 栈区

由系统进行内存的管理。主要存放函数的参数以及局部变量。在函数完成执行，系统自行释放栈区内存，不需要用户管理。

### 静态存储区

静态存储区内的变量在程序编译阶段已经分配好内存空间并初始化。这块内存在程序的整个运行期间都存在，它主要存放静态变量、全局变量和常量。

1. 这里不区分初始化和未初始化的数据区，是因为静态存储区内的变量若不显示初始化，则编译器会自动以默认的方式进行初始化，即静态存储区内不存在未初始化的变量。
2. 静态存储区内的常量分为常变量和字符串常量，一经初始化，不可修改。
3. 静态存储内的常变量是全局变量，与局部常变量不同，区别在于局部常变量存放于栈，实际可间接通过指针或者引用进行修改，而全局常变量存放于静态常量区则不可以间接修改。
4. 字符串常量存储在静态存储区的常量区，字符串常量的名称即为它本身，属于常变量。

### 代码示例

```
int a = 0;//静态全局变量区
char *p1; //编译器默认初始化为NULL
void main()
{
    int b; //栈
    char s[] = "abc"; //栈
    char *p2 = "123456"; //123456在字符串常量区，p2在栈上
    static int c = 0; //c在静态变量区，0为文字常量，在代码区
    const int d = 0; //栈
    static const int d; //静态常量区
    p1 = (char *)malloc(10); //分配得来得10字节在堆区。
    strcpy(p1, "123456"); //123456放在字符串常量区，编译器可能会将它与p2所指向的"123456"优化成一个地方
}
```